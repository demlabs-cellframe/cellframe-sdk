# CellFrame SDK DAG-POA Consensus Module

## Обзор

**DAG-POA (Directed Acyclic Graph - Proof of Authority)** - это алгоритм консенсуса на основе направленного ациклического графа и авторитетных узлов. В отличие от традиционных блокчейн-систем, DAG-POA использует DAG структуру для организации транзакций и блоков.

## Основные характеристики

- **Структура данных**: DAG вместо линейной цепочки блоков
- **Авторизация**: Основан на сертификатах авторитетных узлов
- **Производительность**: Высокая пропускная способность благодаря параллельной обработке
- **Безопасность**: Криптографическая защита через цифровые подписи

## Архитектура

### Основные компоненты

```c
typedef struct dap_chain_cs_dag_poa {
    dap_chain_t * chain;                    // Ссылка на цепочку
    dap_chain_cs_dag_t * dag;               // DAG структура
    void * _pvt;                           // Приватные данные
    void * _inheritor;                     // Наследуемые данные
} dap_chain_cs_dag_poa_t;
```

### Callback система

```c
typedef int (*dap_chain_cs_dag_poa_callback_t)(
    dap_chain_t *,                          // Цепочка
    dap_chain_cs_dag_event_t*,             // Событие DAG
    size_t,                                // Размер данных
    void *                                 // Пользовательские данные
);
```

## API интерфейс

### Инициализация и деинициализация

```c
// Инициализация модуля
int dap_chain_cs_dag_poa_init();

// Деинициализация модуля
void dap_chain_cs_dag_poa_deinit(void);
```

### Управление авторизацией

```c
// Получение списка авторитетных сертификатов
dap_list_t *dap_chain_cs_dag_poa_get_auth_certs(
    dap_chain_t *a_chain,                   // Цепочка
    size_t *a_auth_certs_count,             // Количество сертификатов
    uint16_t *a_count_verify                // Количество для верификации
);
```

### Callback функции

```c
// Установка callback для предварительной подписи
void dap_chain_cs_dag_poa_presign_callback_set(
    dap_chain_t *a_chain,                   // Цепочка
    dap_chain_cs_dag_poa_callback_t a_callback, // Callback функция
    void *a_arg                            // Аргументы callback
);
```

## Принцип работы

### 1. Структура DAG

DAG-POA организует транзакции в направленный ациклический граф, где:

- **Узлы**: Представляют транзакции или события
- **Ребра**: Показывают зависимости между транзакциями
- **Авторизация**: Каждый узел должен быть подписан авторитетным сертификатом

### 2. Процесс консенсуса

1. **Создание события**: Транзакция формируется в DAG событие
2. **Подписание**: Событие подписывается авторитетным узлом
3. **Валидация**: Другие узлы проверяют подпись и корректность
4. **Подтверждение**: После достижения консенсуса событие подтверждается

### 3. Callback механизм

Система поддерживает callback'и для:

- **Предварительной подписи**: Валидация перед подписанием
- **Обработки событий**: Реакция на новые события в DAG
- **Синхронизации**: Обработка входящих событий от других узлов

## Преимущества DAG-POA

### Производительность
- **Параллельная обработка**: Несколько транзакций могут обрабатываться одновременно
- **Высокая пропускная способность**: Отсутствие очередей на подтверждение
- **Масштабируемость**: Легко добавлять новые авторитетные узлы

### Безопасность
- **Криптографическая защита**: Все транзакции подписаны авторитетными ключами
- **Иммутабельность**: Невозможно изменить подтвержденные транзакции
- **Отказоустойчивость**: Система продолжает работать при отказе части узлов

### Гибкость
- **Настраиваемые правила**: Возможность настройки количества требуемых подписей
- **Динамическое управление**: Добавление/удаление авторитетных узлов
- **Расширяемость**: Легко интегрировать новые типы транзакций

## Использование

### Базовая инициализация

```c
#include "dap_chain_cs_dag_poa.h"

// Инициализация консенсуса
if (dap_chain_cs_dag_poa_init() != 0) {
    // Обработка ошибки
}

// Работа с консенсусом...

// Деинициализация
dap_chain_cs_dag_poa_deinit();
```

### Настройка callback'ов

```c
// Callback функция для предварительной подписи
int my_presign_callback(dap_chain_t *chain,
                       dap_chain_cs_dag_event_t *event,
                       size_t data_size,
                       void *arg) {
    // Логика валидации события
    return 0; // 0 - успех, отрицательное значение - ошибка
}

// Установка callback
dap_chain_cs_dag_poa_presign_callback_set(chain, my_presign_callback, NULL);
```

### Получение авторитетных сертификатов

```c
size_t certs_count;
uint16_t verify_count;
dap_list_t *auth_certs = dap_chain_cs_dag_poa_get_auth_certs(
    chain, &certs_count, &verify_count
);

// Использование сертификатов...
dap_list_free(auth_certs);
```

## Сравнение с другими алгоритмами

| Алгоритм | Структура | Авторизация | Производительность |
|----------|-----------|-------------|-------------------|
| DAG-POA | Граф | Сертификаты | Высокая |
| Block-POW | Цепочка | Proof-of-Work | Средняя |
| ESBOCS | Цепочка | Proof-of-Stake | Высокая |

## Заключение

DAG-POA представляет собой эффективный алгоритм консенсуса для сценариев, требующих высокой производительности и надежной авторизации. Его DAG структура позволяет добиться значительного улучшения пропускной способности по сравнению с традиционными блокчейн-системами, сохраняя при этом высокий уровень безопасности и надежности.
