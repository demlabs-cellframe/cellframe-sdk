# üß™ –°–ò–°–¢–ï–ú–ê –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ë–ò–õ–õ–ò–ù–ì–û–í–û–ì–û –ú–û–î–£–õ–Ø

## üìã **–ê–†–•–ò–¢–ï–ö–¢–£–†–ê –¢–ï–°–¢–û–í**

### **‚ö° –ö–ê–¢–ï–ì–û–†–ò–ò –¢–ï–°–¢–û–í**

| **–ö–∞—Ç–µ–≥–æ—Ä–∏—è** | **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** | **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é** | **–û–ø–∏—Å–∞–Ω–∏–µ** |
|---------------|---------------------|------------------|--------------|
| **FAST** | < 100ms –∫–∞–∂–¥—ã–π | ‚úÖ –í–∫–ª—é—á–µ–Ω—ã | –ë—ã—Å—Ç—Ä—ã–µ unit —Ç–µ—Å—Ç—ã |
| **INTEGRATION** | < 1s –∫–∞–∂–¥—ã–π | ‚úÖ –í–∫–ª—é—á–µ–Ω—ã | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| **STRESS** | –ü–µ—Ä–µ–º–µ–Ω–Ω–æ–µ | ‚ùå –û—Ç–∫–ª—é—á–µ–Ω—ã | –°—Ç—Ä–µ—Å—Å —Ç–µ—Å—Ç—ã |
| **PERFORMANCE** | –î–æ 60s | ‚ùå –û—Ç–∫–ª—é—á–µ–Ω—ã | –ë–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |
| **LONG_RUNNING** | > 10s | ‚ùå –û—Ç–∫–ª—é—á–µ–Ω—ã | –î–æ–ª–≥–∏–µ —Ç–µ—Å—Ç—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ |

## üõ†Ô∏è **–°–ë–û–†–ö–ê –¢–ï–°–¢–û–í**

### **–ë–∞–∑–æ–≤–∞—è —Å–±–æ—Ä–∫–∞ (—Ç–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ):**
```bash
cd /home/happy-sloth/WORK/cellframe-node/build
cmake .. 
make billing_tests
```

### **–°–±–æ—Ä–∫–∞ —Å–æ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞–º–∏:**
```bash
cmake -DENABLE_STRESS_TESTS=ON ..
make billing_tests
```

### **–°–±–æ—Ä–∫–∞ —Å–æ –≤—Å–µ–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Ç–µ—Å—Ç–æ–≤:**
```bash
cmake -DENABLE_STRESS_TESTS=ON \
      -DENABLE_PERFORMANCE_TESTS=ON \
      -DENABLE_LONG_RUNNING_TESTS=ON \
      -DENABLE_VALGRIND_TESTS=ON ..
make billing_tests
```

## üöÄ **–ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í**

### **üéØ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
```bash
# –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (< 10 —Å–µ–∫—É–Ω–¥ –æ–±—â–µ–µ –≤—Ä–µ–º—è)
./billing_tests --category=FAST

# –ë—ã—Å—Ç—Ä—ã–µ + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ (< 1 –º–∏–Ω—É—Ç—ã)
./billing_tests --category=DEFAULT
# –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ
./billing_tests
```

### **üîß –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:**
```bash
# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
./billing_tests --category=INTEGRATION

# –¢–æ–ª—å–∫–æ —Å—Ç—Ä–µ—Å—Å —Ç–µ—Å—Ç—ã (–µ—Å–ª–∏ —Å–æ–±—Ä–∞–Ω—ã)
./billing_tests --category=STRESS

# –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã
./billing_tests --category=ALL
```

### **üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞:**
```bash
# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
./billing_tests --verbose

# JUnit XML –¥–ª—è CI/CD
./billing_tests --output=junit --output-file=test_results.xml

# JSON —Ñ–æ—Ä–º–∞—Ç
./billing_tests --output=json --output-file=results.json

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
./billing_tests --stop-on-failure
```

### **‚ö° –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫:**
```bash
# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (–¥–ª—è —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–æ–≤)
./billing_tests --category=STRESS --parallel=4
```

## üìà **CI/CD –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø**

### **GitHub Actions / GitLab CI –ø—Ä–∏–º–µ—Ä—ã:**

#### **–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ PR:**
```yaml
- name: Quick Tests
  run: |
    cd build
    ./billing_tests --category=FAST --output=junit --output-file=quick-results.xml
```

#### **–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ main:**
```yaml
- name: Full Tests  
  run: |
    cd build
    cmake -DENABLE_STRESS_TESTS=ON ..
    make billing_tests
    ./billing_tests --category=DEFAULT --output=junit --output-file=full-results.xml
```

#### **–ù–æ—á–Ω—ã–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã:**
```yaml
- name: Nightly Stress Tests
  run: |
    cd build
    cmake -DENABLE_STRESS_TESTS=ON -DENABLE_PERFORMANCE_TESTS=ON ..
    make billing_tests
    ./billing_tests --category=ALL --output=junit --output-file=stress-results.xml
```

## üß∞ **–†–ê–ó–†–ê–ë–û–¢–ö–ê –¢–ï–°–¢–û–í**

### **–°–æ–∑–¥–∞–Ω–∏–µ –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞:**
```c
#include "billing_test_framework.h"

FAST_TEST(my_feature_test, "Test my new feature")
{
    // –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è < 100ms
    TEST_ASSERT_EQUAL(expected, actual);
    return TEST_RESULT_PASS;
}
```

### **–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞:**
```c
#ifdef ENABLE_STRESS_TESTS

STRESS_TEST(my_stress_test, "Stress test for my feature")
{
    // –¢–µ—Å—Ç –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–æ–ª–≥–æ
    BENCHMARK_START();
    
    // ... —Ç—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ...
    
    BENCHMARK_END("My stress operation");
    return TEST_RESULT_PASS;
}

#endif // ENABLE_STRESS_TESTS
```

### **–£—Å–ª–æ–≤–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è:**
```c
// –ö–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–æ–≤
IF_STRESS_ENABLED({
    // –°–æ–∑–¥–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –º–∞—Å—Å–∏–≤–æ–≤ –¥–∞–Ω–Ω—ã—Ö
    large_data_array = malloc(HUGE_SIZE);
})

// –ö–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
IF_PERFORMANCE_ENABLED({
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫–∞
    init_profiler();
})
```

## üéõÔ∏è **–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –í–†–ï–ú–ï–ù–ò –í–´–ü–û–õ–ù–ï–ù–ò–Ø**

### **–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤:**
```c
// –í —Ç–µ—Å—Ç–æ–≤–æ–º —Ñ–∞–π–ª–µ
#define TEST_TIMEOUT_FAST          50    // –£—Å–∫–æ—Ä–∏—Ç—å –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
#define TEST_TIMEOUT_INTEGRATION   500   // –£—Å–∫–æ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ
```

### **–ò–º–∏—Ç–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**
```c
// –í–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è
test_simulate_time_passage(60000); // –°–∏–º—É–ª—è—Ü–∏—è 60 —Å–µ–∫—É–Ω–¥

// –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö
#define GRACE_PERIOD_TEST_MS  100   // –í–º–µ—Å—Ç–æ 60000ms –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
```

## üìä **–ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø**

### **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:**
```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (5-10 —Å–µ–∫—É–Ω–¥)
make billing_tests && ./billing_tests --category=FAST

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º (30-60 —Å–µ–∫—É–Ω–¥)  
./billing_tests --category=DEFAULT

# –û—Ç–ª–∞–¥–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
./billing_tests --category=FAST --verbose --stop-on-failure
```

### **–ü–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º:**
```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞–º–∏
cmake -DENABLE_STRESS_TESTS=ON ..
make billing_tests
./billing_tests --category=ALL --verbose
```

### **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```bash
# –°–±–æ—Ä–∫–∞ —Å –±–µ–Ω—á–º–∞—Ä–∫–∞–º–∏
cmake -DENABLE_PERFORMANCE_TESTS=ON ..
make billing_tests
./billing_tests --category=PERFORMANCE --output=json --output-file=benchmarks.json
```

## üîç **–û–¢–õ–ê–î–ö–ê –¢–ï–°–¢–û–í**

### **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å Valgrind:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω ENABLE_VALGRIND_TESTS)
make test_valgrind

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å valgrind
valgrind --tool=memcheck --leak-check=full ./billing_tests --category=FAST
```

### **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å GDB:**
```bash
# –û—Ç–ª–∞–¥–∫–∞ —É–ø–∞–≤—à–µ–≥–æ —Ç–µ—Å—Ç–∞
gdb ./billing_tests
(gdb) run --category=FAST --stop-on-failure
```

### **ThreadSanitizer –¥–ª—è race conditions:**
```bash
# –°–±–æ—Ä–∫–∞ —Å ThreadSanitizer
cmake -DCMAKE_C_FLAGS="-fsanitize=thread" ..
make billing_tests
./billing_tests --category=STRESS
```

## üìã **–°–ü–ò–°–û–ö –ö–û–ú–ê–ù–î**

### **Make targets:**
```bash
make test_fast           # –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
make test_integration    # –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ  
make test_stress         # –¢–æ–ª—å–∫–æ —Å—Ç—Ä–µ—Å—Å (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã)
make test_performance    # –¢–æ–ª—å–∫–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã)
make test_default        # –ë—ã—Å—Ç—Ä—ã–µ + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ
make test_all           # –í—Å–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
make test_ci_quick      # CI –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
make test_ci_full       # CI –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
make test_valgrind      # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å valgrind (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞)
```

### **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–∫–∏:**
```bash
./billing_tests --help          # –ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞
./billing_tests --list          # –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
```

---

## üéØ **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ**

### **‚úÖ –î–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--category=FAST` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ `--category=DEFAULT` –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 10-60 —Å–µ–∫—É–Ω–¥

### **‚úÖ –î–ª—è CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–≤:**
- **Pull Request –ø—Ä–æ–≤–µ—Ä–∫–∏:** `FAST` –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–±—ã—Å—Ç—Ä–æ)
- **Merge –≤ main:** `DEFAULT` –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–¥–µ–∂–Ω–æ)  
- **–ù–æ—á–Ω—ã–µ —Å–±–æ—Ä–∫–∏:** `ALL` –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ)

### **‚úÖ –î–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –í–∫–ª—é—á–∞–π—Ç–µ `STRESS` –∏ `PERFORMANCE` —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–∞–π–ª—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### **‚ùå –ò–∑–±–µ–≥–∞–π—Ç–µ:**
- –ó–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤ –æ–±—ã—á–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- –í–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–æ–≤ –≤ –±—ã—Å—Ç—Ä—ã—Ö CI –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤ –≤ –¥–æ–ª–≥–∏—Ö —Ç–µ—Å—Ç–∞—Ö
